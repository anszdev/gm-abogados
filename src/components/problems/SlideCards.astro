---
import Arrow from "../icons/Arrow.astro";
import ArrowR from "../icons/ArrowR.astro";
import { Card } from "./Card";

const cardsData = [
  {
    title: "Despido injustificado sin liquidación",
    content:
      "El empleador termina la relación laboral sin causa legal y sin pagar las indemnizaciones y prestaciones obligatorias al trabajador.",
    icon: "/images/document-dismiss.svg",
    tags: ["ART. 48"],
  },
  {
    title: "Acoso Laboral o Discriminación",
    content:
      "Cualquier trato hostil, intimidatorio o diferencia de trato injustificada en el trabajo, basada en características personales, que afecte la dignidad o cree un ambiente ofensivo.",
    icon: "/images/emoji-sad.svg",
    tags: ["ART. 3o. Bis", "ART. 133"],
  },
  {
    title: "Falta de Pago de Horas Extras o Prestaciones",
    content:
      "El empleador no paga el tiempo trabajado fuera de la jornada legal (horas extras) o no entrega las prestaciones obligatorias por ley, como aguinaldo, vacaciones o prima vacacional.",
    icon: "/images/money.svg",
    tags: ["ART. 67", "ART. 68"],
  },
  {
    title: "Problemas con tu Contrato o Salario",
    content:
      "Cuando tu contrato no está por escrito, incluye cláusulas ilegales que renuncian a tus derechos, o tu salario se paga incompleto, con retraso o es inferior al mínimo legal.",
    icon: "/images/contract.svg",
    tags: ["ART. 25", "ART. 110"],
  },
  {
    title: "Accidentes en el trabajo",
    content:
      "Lesiones o enfermedades sufridas por el trabajador a causa o con motivo de su trabajo, que pueden generar incapacidad temporal, permanente o la muerte.",
    icon: "/images/doctor.svg",
    tags: ["ART. 473", "ART. 487"],
  },
  {
    title: "¿Tu situación es distinta? Cuéntanos tu caso.",
    content: "Cuéntanos más sobre tu situación y cómo podemos ayudarte.",
    icon: "/images/handshake.svg",
  },
];
---

<div>
  <div class="gm_slides">
    {
      cardsData.map((card) => (
        <Card
          client:visible
          cardTitle={card.title}
          cardContent={card.content}
          cardIcon={card.icon}
          cardTags={card.tags}
        />
      ))
    }
  </div>
  <div class="gm_slide-buttons">
    <button class="gm_slide-button" id="prev-slide"><Arrow /></button>
    <button class="gm_slide-button" id="next-slide"><ArrowR /></button>
  </div>
</div>

<style>
  .gm_slide-button {
    width: 3rem;
    height: 3rem;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    border-radius: 999px;
    background: linear-gradient(to bottom, var(--gm-accent), #d9c39c);
    border: none;
    cursor: pointer;
    color: var(--gm-bg-secondary);
    transition: transform 150ms ease-in-out;

    &:active {
      transform: scale(0.95);
    }

    @media screen and (width >= 1024px) {
      display: none;
    }
  }

  .gm_slides {
    display: flex;
    width: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    margin: 2rem 0;

    &::-webkit-scrollbar {
      width: 1px;
      height: 1px;
    }

    &::-webkit-scrollbar-thumb {
      background: transparent;
    }

    &::-webkit-scrollbar-track {
      background: var(--gm-bg-secondary);
    }

    @media screen and (width >= 768px) {
      margin: 5rem 0;
      gap: 2rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const slideContainer = document.querySelector(".gm_slides");
    const prevButton = document.getElementById("prev-slide");
    const nextButton = document.getElementById("next-slide");
    const slides = document.querySelectorAll(".gm_slide-card");

    if (!slideContainer || !prevButton || !nextButton || slides.length === 0) {
      console.error(
        "No se encontraron los elementos necesarios para el carrusel."
      );
      return;
    }

    let currentIndex = 0;
    const totalSlides = slides.length;

    /**
     * Actualiza la posición del scroll para mostrar el slide correcto.
     */
    const updateSliderPosition = () => {
      // Usamos el ancho de un slide individual para el cálculo
      const slideWidth = slides[0].clientWidth;
      const newScrollLeft = currentIndex * slideWidth;
      slideContainer.scrollTo({
        left: newScrollLeft,
        behavior: "smooth",
      });
    };

    // Evento para el botón "siguiente"
    nextButton.addEventListener("click", () => {
      if (currentIndex < totalSlides - 1) {
        currentIndex++;
        updateSliderPosition();
      }
    });

    // Evento para el botón "anterior"
    prevButton.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateSliderPosition();
      }
    });

    // Evento para reajustar el carrusel si cambia el tamaño de la ventana
    window.addEventListener("resize", updateSliderPosition);
  });
</script>
